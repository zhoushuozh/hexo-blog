{"title":"使用JS和Canvas做一个画板","date":"2018-03-10T17:22:14.000Z","thumbnail":"https://cdn.zhoushuo.me/zhoushuodrawing.png","slug":"drawing-borad","comments":true,"tags":["Canvas","HTML5","JavaScript"],"categories":["前端"],"updated":"2019-01-20T12:03:15.165Z","content":"<p>前些天学习了<code>HTML5</code>的<code>&lt;canvas&gt;</code>元素，今天就来实践一下，用<code>canvas</code>做一个画板。</p>\n<p>首先说一下要实现的功能：</p>\n<ul>\n<li>切换画笔颜色</li>\n<li>调整笔刷粗细</li>\n<li>清空画布</li>\n<li>橡皮擦擦除</li>\n<li>撤销操作</li>\n<li>保存成图片</li>\n<li>兼容移动端（支持触摸）</li>\n</ul>\n<p>好了，废话少说，先看最终效果：<a href=\"https://zhoushuozh.github.io/drawingborad\" target=\"_blank\" rel=\"noopener\">https://zhoushuozh.github.io/drawingborad</a></p>\n<h3 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h3><p>首先，准备个容器,也就是画板了。<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"drawing-board\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>然后初始化js：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"drawing-board\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br></pre></td></tr></table></figure></p>\n<p>我想把画板做成全屏的，所以接下来设置一下<code>canvas</code>的宽高。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> pageWidth = <span class=\"built_in\">document</span>.documentElement.clientWidth;</span><br><span class=\"line\"><span class=\"keyword\">let</span> pageHeight = <span class=\"built_in\">document</span>.documentElement.clientHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">canvas.width = pageWidth;</span><br><span class=\"line\">canvas.height = pageHeight;</span><br></pre></td></tr></table></figure></p>\n<p>由于部分IE不支持<code>canvas</code>，如果要兼容IE，我们可以创建一个<code>canvas</code>，然后使用<code>excanvas</code>初始化，针对IE加上<a href=\"http://code.google.com/p/explorercanvas/\" target=\"_blank\" rel=\"noopener\">exCanvas.js</a>，这里我们暂时先不考虑IE。</p>\n<h3 id=\"实现一个简单的画板\"><a href=\"#实现一个简单的画板\" class=\"headerlink\" title=\"实现一个简单的画板\"></a>实现一个简单的画板</h3><p>实现思路：监听鼠标事件，用<code>drawCircle()</code>方法把记录的数据画出来。</p>\n<ol>\n<li>设置初始化当前画布功能为画笔状态，<code>painting = false</code>，</li>\n<li>当鼠标按下时（<code>mousedown</code>），把<code>painting</code>设为<code>true</code>，表示正在画，鼠标没松开。把鼠标点记录下来。</li>\n<li>当按下鼠标的时候，鼠标移动（<code>mousemove</code>）就把点记录下来并画出来。</li>\n<li>如果鼠标移动过快，浏览器跟不上绘画速度，点与点之间会产品间隙，所以我们需要将画出的点用线连起来（<code>lineTo()</code>）。</li>\n<li>鼠标松开的时候（<code>mouseup</code>），把<code>painting</code>设为<code>false</code>。</li>\n</ol>\n<p>代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> painting = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> lastPoint = &#123;<span class=\"attr\">x</span>: <span class=\"literal\">undefined</span>, <span class=\"attr\">y</span>: <span class=\"literal\">undefined</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//鼠标按下事件</span></span><br><span class=\"line\">canvas.onmousedown = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    painting = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> x = e.clientX;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> y = e.clientY;</span><br><span class=\"line\">    lastPoint = &#123;<span class=\"string\">\"x\"</span>: x, <span class=\"string\">\"y\"</span>: y&#125;;</span><br><span class=\"line\">    drawCircle(x, y, <span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//鼠标移动事件</span></span><br><span class=\"line\">canvas.onmousemove = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (painting) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> x = e.clientX;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> y = e.clientY;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newPoint = &#123;<span class=\"string\">\"x\"</span>: x, <span class=\"string\">\"y\"</span>: y&#125;;</span><br><span class=\"line\">        drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y,clear);</span><br><span class=\"line\">        lastPoint = newPoint;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//鼠标松开事件</span></span><br><span class=\"line\">canvas.onmouseup = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    painting = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 画点函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawCircle</span>(<span class=\"params\">x, y, radius</span>) </span>&#123;</span><br><span class=\"line\">    ctx.save();</span><br><span class=\"line\">    ctx.beginPath();</span><br><span class=\"line\">    ctx.arc(x, y, radius, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI * <span class=\"number\">2</span>);</span><br><span class=\"line\">    ctx.fill();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 划线函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawLine</span>(<span class=\"params\">x1, y1, x2, y2</span>) </span>&#123;</span><br><span class=\"line\">    ctx.lineWidth = <span class=\"number\">3</span>;</span><br><span class=\"line\">    ctx.lineCap = <span class=\"string\">\"round\"</span>;</span><br><span class=\"line\">    ctx.lineJoin = <span class=\"string\">\"round\"</span>;</span><br><span class=\"line\">    ctx.moveTo(x1, y1);</span><br><span class=\"line\">    ctx.lineTo(x2, y2);</span><br><span class=\"line\">    ctx.stroke();</span><br><span class=\"line\">    ctx.closePath();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"橡皮擦功能\"><a href=\"#橡皮擦功能\" class=\"headerlink\" title=\"橡皮擦功能\"></a>橡皮擦功能</h3><p>实现思路</p>\n<ol>\n<li>获取橡皮擦元素</li>\n<li>设置橡皮擦初始状态，<code>clear = false</code>。</li>\n<li>监听橡皮擦<code>click</code>事件，点击橡皮擦，改变橡皮擦状态，<code>clear = true</code>。</li>\n<li><code>clear</code>为<code>true</code>时，移动鼠标使用<code>canvas</code>剪裁（<code>clip()</code>）擦除画布。</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> eraser = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"eraser\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> clear = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">eraser.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    clear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">...javaScript</span><br><span class=\"line\"><span class=\"keyword\">if</span> (clear) &#123;</span><br><span class=\"line\">    ctx.save();</span><br><span class=\"line\">    ctx.globalCompositeOperation = <span class=\"string\">\"destination-out\"</span>;</span><br><span class=\"line\">    ctx.stroke();</span><br><span class=\"line\">    ctx.closePath();</span><br><span class=\"line\">    ctx.clip();</span><br><span class=\"line\">    ctx.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,canvas.width,canvas.height);</span><br><span class=\"line\">    ctx.restore();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>注意，在<code>canvas</code>中的裁剪和平时的裁剪功能不一样在这里，裁剪是指在裁剪区域去显示我们所画的图</p>\n<h3 id=\"兼容移动端\"><a href=\"#兼容移动端\" class=\"headerlink\" title=\"兼容移动端\"></a>兼容移动端</h3><p>实现思路：</p>\n<ol>\n<li>判断设备是否支持触摸</li>\n<li><code>true</code>，则使用<code>touch</code>事件；<code>false</code>，则使用<code>mouse</code>事件</li>\n</ol>\n<p>代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.body.ontouchstart !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 使用touch事件</span></span><br><span class=\"line\">    anvas.ontouchstart = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 开始触摸</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    canvas.ontouchmove = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 开始滑动</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    canvas.ontouchend = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 滑动结束</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 使用mouse事件</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure></p>\n<p>这里需要注意的一点是，在<code>touch</code>事件里，是通过<code>.touches[0].clientX</code>和<code>.touches[0].clientY</code>来获取坐标的，这点要和<code>mouse</code>事件区别开。</p>\n<h3 id=\"切换画笔颜色\"><a href=\"#切换画笔颜色\" class=\"headerlink\" title=\"切换画笔颜色\"></a>切换画笔颜色</h3><p>实现思路：</p>\n<ol>\n<li>获取颜色元素节点。</li>\n<li>点击颜色返回其颜色值，并赋给画布的<code>ctx.strokeStyle</code>。</li>\n</ol>\n<p>代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> aColorBtn = <span class=\"built_in\">document</span>.getElementsByClassName(<span class=\"string\">\"color-item\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; aColorBtn.length; i++) &#123;</span><br><span class=\"line\">    aColorBtn[i].onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; aColorBtn.length; i++) &#123;</span><br><span class=\"line\">        activeColor = <span class=\"keyword\">this</span>.style.backgroundColor;</span><br><span class=\"line\">        ctx.strokeStyle = activeColor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"清空画布\"><a href=\"#清空画布\" class=\"headerlink\" title=\"清空画布\"></a>清空画布</h3><p>实现思路：</p>\n<ol>\n<li>获取元素节点。</li>\n<li>点击清空按钮清空canvas画布。</li>\n</ol>\n<p>代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> reSetCanvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"clear\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">reSetCanvas.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ctx.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"调整笔刷粗细\"><a href=\"#调整笔刷粗细\" class=\"headerlink\" title=\"调整笔刷粗细\"></a>调整笔刷粗细</h3><p>实现思路：</p>\n<ol>\n<li>创建input[type=range]</li>\n<li>滑动range获取其value值，并赋给<code>ctx.lineWidth</code></li>\n</ol>\n<p>代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> range = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"range\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">range.onchange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    lWidth = <span class=\"keyword\">this</span>.value;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"保存成图片\"><a href=\"#保存成图片\" class=\"headerlink\" title=\"保存成图片\"></a>保存成图片</h3><p>实现思路：</p>\n<ol>\n<li>获取canvas.toDateURL</li>\n<li>在页面里创建并插入一个a标签</li>\n<li>a标签href等于canvas.toDateURL，并添加download属性</li>\n<li>点击保存按钮，a标签触发click事件</li>\n</ol>\n<p>代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> save = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"save\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">save.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> imgUrl = canvas.toDataURL(<span class=\"string\">\"image/png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> saveA = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(saveA);</span><br><span class=\"line\">    saveA.href = imgUrl;</span><br><span class=\"line\">    saveA.download = <span class=\"string\">\"zspic\"</span> + (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>).getTime();</span><br><span class=\"line\">    saveA.target = <span class=\"string\">\"_blank\"</span>;</span><br><span class=\"line\">    saveA.click();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"撤销\"><a href=\"#撤销\" class=\"headerlink\" title=\"撤销\"></a>撤销</h3><p>实现思路：</p>\n<ol>\n<li>准备一个数组记录历史操作</li>\n<li>每次使用画笔前将当前绘图表面储存进数组</li>\n<li>点击撤销时，恢复到上一步的绘图表面</li>\n</ol>\n<p>代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.ontouchstart = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">// 在这里储存绘图表面</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.firstDot = ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\">    saveData(<span class=\"keyword\">this</span>.firstDot);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> undo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"undo\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> historyDeta = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveData</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    (historyDeta.length === <span class=\"number\">10</span>) &amp;&amp; (historyDeta.shift()); <span class=\"comment\">// 上限为储存10步，太多了怕挂掉</span></span><br><span class=\"line\">    historyDeta.push(data);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">undo.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(historyDeta.length &lt; <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    ctx.putImageData(historyDeta[historyDeta.length - <span class=\"number\">1</span>], <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    historyDeta.pop()</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>因为每次储存都是将一张图片存入内存，对性能影响较大，所以在这里设置了储存上限。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>这里用的知识点主要有：监听<code>mouse</code>、<code>touch</code>事件，以及<code>canvas</code>的<code>moveTo()</code>、<code>lineTo()</code>、<code>stroke()</code>、<code>clip()</code>、<code>clearRect()</code>等方法。我相信还有很多效果可以实现，比如说类似喷雾效果，铅笔字效果，艺术画效果，等等。日后有时间我会继续对这个画板进行优化，增加一些新的功能同时欢迎大家留言提问或者提出批评建议。</p>\n<p>最终代码：<a href=\"https://github.com/zhoushuozh/drawingborad\" target=\"_blank\" rel=\"noopener\">https://github.com/zhoushuozh/drawingborad</a></p>\n","prev":{"title":"【笔记】 vim命令大全","slug":"vim-command"},"next":{"title":"HTML5 Canvas 基础","slug":"html5-canvas"},"link":"https://blog.zhoushuo.me/post/drawing-borad/","copyright":{"author":"zhoushuo","link":"<a href=\"https://blog.zhoushuo.me/post/drawing-borad/\" title=\"使用JS和Canvas做一个画板\">https://blog.zhoushuo.me/post/drawing-borad/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2018年3月11日"}}