{"title":"简单实现 jQuery 中的几个 API","date":"2018-04-20T17:05:19.000Z","slug":"jquery-api","comments":true,"tags":["JavaScript","jQuery"],"updated":"2019-01-20T08:51:06.788Z","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>对于操作 DOM 来说，jQuery 是非常方便的一个库，虽然如今随着 React, Vue 之类框架的流行，jQuery 用得越来越少了，但是其中很多思想还是非常值得我们学习的，这篇文章将介绍如何实现 jQuery 中的几个 api 。</p>\n<a id=\"more\"></a>\n<h3 id=\"任务\"><a href=\"#任务\" class=\"headerlink\" title=\"任务\"></a>任务</h3><p>首先说一下要实现 API ：</p>\n<ol>\n<li>$()：根据选择器构造一个 jQuery 对象</li>\n<li>addClass()：为每个匹配的元素添加指定的样式类名</li>\n<li>text()：获取匹配元素集合中每个元素的合并文本，设置匹配元素集合中每个元素的文本内容为指定的文本内容。</li>\n<li>css()：获取匹配元素集合中的第一个元素的样式属性的值设置每个匹配元素的一个或多个CSS属性。</li>\n</ol>\n<h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><h3 id=\"构造-jQuery-对象\"><a href=\"#构造-jQuery-对象\" class=\"headerlink\" title=\"构造 jQuery 对象\"></a>构造 jQuery 对象</h3><p>接受一个 node 或选择器，构造并返回一个类数组对象。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\">selector</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nodes = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> selector === <span class=\"string\">'string'</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 利用temp去掉多余的原型，直接指向object.prototype</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> temp = <span class=\"built_in\">document</span>.querySelectorAll(selector)</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;temp.length; i++)&#123;</span><br><span class=\"line\">            nodes[i] = temp[i] </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        nodes.length = temp.length</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(selector <span class=\"keyword\">instanceof</span> Node)&#123;</span><br><span class=\"line\">        nodes = &#123;</span><br><span class=\"line\">            <span class=\"number\">0</span>: selector, </span><br><span class=\"line\">            length:<span class=\"number\">1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> nodes</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"addClass\"><a href=\"#addClass\" class=\"headerlink\" title=\"addClass\"></a>addClass</h3><p>接受一个或多个 class ，遍历每个元素，为元素添加 class 。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addClass</span>(<span class=\"params\">className</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">        nodes[i].classList.add(className)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"text\"><a href=\"#text\" class=\"headerlink\" title=\"text\"></a>text</h3><p>如果有接受参数，则为所有匹配元素设置文本内容；如果没有接受参数，则返回所有匹配元素文本的集合。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">text</span>(<span class=\"params\">content</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(content === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> texts = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">            texts.push(nodes[i].textContent)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> texts</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">            nodes[i].textContent = content</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"css\"><a href=\"#css\" class=\"headerlink\" title=\"css\"></a>css</h3><p>css() 接受<code>propertyname</code>和 <code>value</code>两个参数，遍历所有匹配元素，设置指定的 css 属性；如果 <code>value</code>为空，并且<code>propertyname</code>为<code>string</code>，则返回第一个元素指定的 css 属性值；如果<code>propertyname</code>为<code>object</code>，如<code>{&quot;propertyname&quot;:&quot;value&quot;,&quot;propertyname&quot;:&quot;value&quot;,...}</code>，则遍历所有匹配元素和<code>propertyname</code>，设置指定的 css 属性。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">css</span>(<span class=\"params\">propertyname,value</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(value === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> propertyname === <span class=\"string\">'string'</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.getComputedStyle(nodes[<span class=\"number\">0</span>],<span class=\"literal\">null</span>).getPropertyValue(propertyname)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> propertyname === <span class=\"string\">'object'</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> style <span class=\"keyword\">in</span> propertyname)&#123;</span><br><span class=\"line\">                    nodes[i].setAttribute(<span class=\"string\">'style'</span>, style+<span class=\"string\">\":\"</span>+propertyname[style])</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">            nodes[i].setAttribute(<span class=\"string\">'style'</span>,propertyname+<span class=\"string\">\":\"</span>+value)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"封装\"><a href=\"#封装\" class=\"headerlink\" title=\"封装\"></a>封装</h3><p>最终代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.jQuery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selector</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nodes = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> selector === <span class=\"string\">'string'</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> temp = <span class=\"built_in\">document</span>.querySelectorAll(selector)</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;temp.length; i++)&#123;</span><br><span class=\"line\">            nodes[i] = temp[i] </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        nodes.length = temp.length</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(selector <span class=\"keyword\">instanceof</span> Node)&#123;</span><br><span class=\"line\">        nodes = &#123;</span><br><span class=\"line\">            <span class=\"number\">0</span>: selector, </span><br><span class=\"line\">            length:<span class=\"number\">1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    nodes.addClass = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">className</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">            nodes[i].classList.add(className)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    nodes.text = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">content</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(content === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> texts = []</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">                texts.push(nodes[i].textContent)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> texts</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">                nodes[i].textContent = content</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    nodes.css = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">propertyname,value</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(value === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> propertyname === <span class=\"string\">'string'</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.getComputedStyle(nodes[<span class=\"number\">0</span>],<span class=\"literal\">null</span>).getPropertyValue(propertyname)</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> propertyname === <span class=\"string\">'object'</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> style <span class=\"keyword\">in</span> propertyname)&#123;</span><br><span class=\"line\">                        nodes[i].setAttribute(<span class=\"string\">'style'</span>, style+<span class=\"string\">\":\"</span>+propertyname[style])</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i&lt;nodes.length; i++)&#123;</span><br><span class=\"line\">                nodes[i].setAttribute(<span class=\"string\">'style'</span>,propertyname+<span class=\"string\">\":\"</span>+value)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> nodes</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.$ = jQuery</span><br></pre></td></tr></table></figure>\n<h2 id=\"效果测试\"><a href=\"#效果测试\" class=\"headerlink\" title=\"效果测试\"></a>效果测试</h2><p>下面的代码是获取 id 为 <code>wraper</code>下 class 为<code>item</code>的元素，设置文本内容为 hello ，并添加 <code>font-size:20px</code>的 css 样式，最后添加 class <code>red</code>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\"#wraper &gt; .item\"</span>).text(<span class=\"string\">\"hello\"</span>).css(<span class=\"string\">\"font-size\"</span>,<span class=\"string\">\"20px\"</span>).addClass(<span class=\"string\">\"red\"</span>)</span><br></pre></td></tr></table></figure>\n","prev":{"title":"从输入URL到页面加载完成的过程中都发生了什么","slug":"from-url-page"},"next":{"title":"JavaScript常见原生DOM操作API总结","slug":"dom-api"},"link":"https://blog.zhoushuo.me/post/jquery-api/","toc":[{"title":"背景","id":"背景","index":"1","children":[{"title":"任务","id":"任务","index":"1.1"}]},{"title":"实现步骤","id":"实现步骤","index":"2","children":[{"title":"构造 jQuery 对象","id":"构造-jQuery-对象","index":"2.1"},{"title":"addClass","id":"addClass","index":"2.2"},{"title":"text","id":"text","index":"2.3"},{"title":"css","id":"css","index":"2.4"},{"title":"封装","id":"封装","index":"2.5"}]},{"title":"效果测试","id":"效果测试","index":"3"}],"copyright":{"author":"zhoushuo","link":"<a href=\"https://blog.zhoushuo.me/post/jquery-api/\" title=\"简单实现 jQuery 中的几个 API\">https://blog.zhoushuo.me/post/jquery-api/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2018年4月21日"}}